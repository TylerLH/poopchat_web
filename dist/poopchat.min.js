!function(e){try{e=angular.module("poopchat-templates")}catch(t){e=angular.module("poopchat-templates",[])}e.run(["$templateCache",function(e){e.put("/poopchat/chat/chat.html",'<div class="messages-container" autoscroller=""><div class="message" ng-repeat="message in messages"><div><strong class="author">{{message.user || \'anonymous\'}}</strong> <small class="text-muted" am-time-ago="message.timestamp"></small></div><span ng-bind-html="message.content | image_linky:\'_blank\' | emoji"></span></div></div><form ng-submit="sendMessage()" class="message-form"><input class="message-input" ng-model="message.content" placeholder="Talk to fellow poopers..." required autofocus><button type="submit" class="btn-send">Send</button></form>')}])}(),angular.module("poopchat",["ui.router","ngAnimate","ngSanitize","duScroll","LocalStorageModule","angularMoment","emoji","poopchat-templates"]),function(){"use strict";function e(e,t,s,a){var n=s.get("username");n&&(e.username=n),t.setUsername=function(){var t=a.prompt("What would you like your username to be?");t&&(e.username=t,s.set("username",t))}}angular.module("poopchat").controller("AppController",["$rootScope","$scope","localStorageService","$window",e])}(),function(){"use strict";angular.module("poopchat").directive("autoscroller",[function(){return{restrict:"A",link:function(e,t){e.$watchCollection("messages",function(){t.scrollTo(0,t[0].scrollHeight)})}}}])}(),function(){"use strict";function e(e,t,s){e.messages=[],e.message={},e.previousMessage={},s.stream.onmessage=function(t){var s=JSON.parse(t);e.messages.push(s),e.$digest()};var a=function(){e.previousMessage=e.message,e.message={}},n=function(){e.messages.push({content:"There was a problem sending your message. Try again..."})};e.sendMessage=function(){s.connected?(e.username&&(e.message.user=e.username),e.message.timestamp=new Date,s.sendMessage(e.message,a,n)):e.messages.push({content:"You're not connected!"})}}angular.module("poopchat").controller("ChatController",["$scope","$log","socket",e])}(),function(){"use strict";angular.module("poopchat").service("PushStream",["$window",function(e){return e.PushStream}]),angular.module("poopchat").factory("socket",["$rootScope","PushStream",function(e,t){var s={connecting:!1,connected:!1};return s.stream=new t({host:"chat.poopchat.me",modes:"websocket|stream|longpolling"}),s.sendMessage=function(e,t,s){this.stream.sendMessage(JSON.stringify(e),t,s)},s.stream.onstatuschange=function(e){switch(e){case t.CONNECTING:s.connecting=!0;break;case t.OPEN:s.connected=!0;break;case t.CLOSED:s.connected=!1}},s.stream.addChannel("global"),s.stream.connect(),s}])}(),function(){"use strict";angular.module("poopchat").config(["$stateProvider","$urlRouterProvider","$locationProvider",function(e,t,s){s.html5Mode(!0),t.otherwise("/"),e.state("chat",{url:"/",templateUrl:"/poopchat/chat/chat.html",controller:"ChatController"})}])}(),angular.module("poopchat").filter("image_linky",["$sanitize",function(e){var t=/((ftp|https?):\/\/|(mailto:)?[A-Za-z0-9._%+-]+@)\S*[^\s.;,(){}<>]/,s=/^mailto:/,a=/(https?:\/\/.*\.(?:png|jpg|gif|jpeg)(\?\w*)?)/i;return function(n){function o(e){e&&g.push(e)}function r(e,t){g.push("<a "),g.push('target="'),g.push("_blank"),g.push('" '),g.push('href="'),g.push(e),g.push('">'),o(t),g.push("</a>")}function c(e){g.push('<div class="image-container">'),g.push('<a href="'+e+'" target="_blank"><img src="'+e+'" /></a>'),g.push("</div>")}if(!n)return n;for(var u,i,l,m=n,g=[];u=m.match(a);)i=u[0],l=u.index,c(i),m=m.substring(l+u[0].length);for(;u=m.match(t);)i=u[0],u[2]==u[3]&&(i="mailto:"+i),l=u.index,o(m.substr(0,l)),r(i,u[0].replace(s,"")),m=m.substring(l+u[0].length);return o(m),e(g.join(""))}}]);